# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами


## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP. Также есть дополнительный слой коммуникации для связи с сервером.
Принцип MVP подразумевает что проект будет разделен на 3 основных слоя: слой данных - то, где хранятся данные,\
слой отображения - инструменты для визуальной работы с данными, и слой презентер -\
обеспечит взаимодествие двух предыдущих слоя.


## Данные и типы данных, используемые в приложении

Карточка продукта

```
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
};
```

Заказ

```
interface IOrder {
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];
};
```

Интерфейс для хранения актуальных карточек товаров

```
interface ICatalogModel {
    items: IProduct[];
    preview: string | null;
    setItems(items: IProduct[]): void;
    getProduct(id: string): IProduct;
};
```

Данные карточки, используемые в корзине

```
type TProductInfo = Pick<IProduct, 'title' | 'price'>;
```

Интерфейс для хранения корзины

```
interface IBasketModel {
    items: TProductInfo[];
    events: IEvents;
    add(item: TProductInfo): void;
    remove(id: string): void;
    getTotal(): number;
    confirm(): void;
    reset(): void; 
};
```

Данные получаемые от сервера при оформении заказа

```
type TOrderResponse = Pick<IOrder, 'total'> & {
    id: string;
};
```

Интерфейс для хранения информации о заказе

```
export interface IOrderModel {
    orderInfo: TOrderInfo;
    orderStage: number;
    events: IEvents;
    set primary(data: TOrderPrimaryInfo);
    set secondary(data: TOrderSecondaryInfo);
    get info(): TOrderInfo;
    checkPayValidation(data: Record<keyof TOrderInfo, string>): boolean;
};
```

Тип первичных данных объекта ифнормации заказа

```
type TOrderPrimaryInfo  = Pick<IOrder, 'payment' | 'address'>;
```

Тип вторичных данных объекта ифнормации заказа

```
type TOrderSecondaryInfo  = Pick<IOrder, 'email' | 'phone'>; 
```

Тип полного объекта информации заказа

```
type TOrderInfo = TOrderPrimaryInfo & TOrderSecondaryInfo;
```


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.\
В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы: 
- `get(uri: string): Promise` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет
эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра 
при вызове.

#### Класс EventEmitter
Брокер событий позволяет создавать собственные события а также подписываться на них. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Реализует интерфейс `IEvents`.\
В конструктор передается массив из событий и подписчиков.\
Основные методы:
- `on<T extends object>(eventName: EventName, callback: (event: T) => void): void` - подписка на событие
- `emit<T extends object>(eventName: string, data?: T): void` - инициализация события
- `trigger<T extends object>(eventName: string, context?: Partial<T>): void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component
Класс компонент является родителем для всех остальных классов отображения в проекте. Предоставляет базовые методы для работы с отображением.\
В конструктор мы передаеnся элемент разметки.\
Методы:
- `render(data?: Partial<T>): HTMLElement` - основной метод класса, который позволяет отрисовать нужные элементы разметки.
- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` - добавить/убрать класс жлементу разметки.
- `protected setText(element: HTMLElement, value: unknown): void` - добавить текстовое содержание в свойство `textContent` элемента разметки.


### Слой модели данных

#### Класс CatalogModel
Класс отвечает за хранение данных карточек.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `items: IProduct[]` - массив объектов карточек
- `preview: string | null` - id карточки, выбранной для просмотра в модальной окне.
Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `setItems(items: IProduct[]): void` - получает весь имеемый на севрере массив карточек
- `getProduct(id: string): IProduct` - возвращает карточку продукта по ее id.

#### Класс BasketModel
Класс отвечает за хранение товаров в корзине.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `items: TProductInfo[]` - массив выбранных для покупки товаров
- `events: IEvents` - инстант класса `EventEmitter` для инициации события при изменении корзины.
Так же класс предоставляет набор методов для взаимодействия с этими данными
- `add(item: TProductInfo): void` - добавляет товар в корзину
- `remove(id: string): void` - удаляет товар из корзины
- `getTotal(): number` - считает сумму стоимости товаров в корзине
- `confirm(): IOrder` - совершить покупку товраов из корзины
- `reset(order: TOrderResponse): void` - обнулить данные корзины при получении `id` заказа

#### Класс OrderModel
Класс отвечает за логику работы с данными текущего заказа
Поля класса:
- `orderInfo: TOrderInfo` - объект с данными заказа.
- `orderStage: number` - стадия заказа.
- `events: IEvents` - инстант класса `EventEmitter` для инициации событий заполнения данных заказа.
Методы:
- `set primary(data: TOrderPrimaryInfo)` - сеттер первичных данных о заказе
- `set secondary(data: TOrderSecondaryInfo)` - сеттер вторичных данных о заказе
- `get info(): TOrderInfo` - геттер данных о заказе
- `checkPayValidation(data: Record<keyof IOrder, string>): boolean` - проверяет объект с данными заказа на валидность


### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
- `constructor(selector: string, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса
- `modal: HTMLElement` - элемент модального окна
- `events: IEvents` - инстант класса `EventEmitter` для иницализации события при изменения корзины.
Методы:
- `set content(value: HTMLElement): void` - сеттер который опредляет содержимое модального окна.
- `render(data: IModalData): HTMLElement` - переопределяет метод родителя Component позволяя модальному окну отобразиться при рендере.

#### Класс Product
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, категории, описания и цены. Класс используется для отображения карточек на странице сайта. В классе устанавливаются слушатель нажатия на карточку для открытия ее в модальном окне.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- `setData(cardData: IProduct): void` - заполняет атрибуты элементов карточки данными.
- `get id(): string` - геттер возвращает id конкретной карточки

#### Класс Catalog
Отвечает за отображение блока с товарами. В конструктор принимает массив товаров. Имеет сеттер:
- `set container(items: Product[]): void` - для размещения всех товаров в каталоге.


### Слой презентера
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Пример взаимодействия: 
1. Пользователь нажимает кнопку "В Корзину" и класс `Modal` генерирует событие `card_full:select`
2. Презентер отслеживает событие и вызывает метод `add` класса `BasketModel`
3. `BasketModel` генерирует событие `basket:change`
4. Презентер обрабатывает событие и вызывает `set counter` класса Page добавляя еденицу
5. Происходит рендер корзины с новым числом товаров.
6. Модальное окно закрывается. 

#### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Список уникальных событий для работы презентера
*События Api*
- `catalog:update` - происходит, когда приложение получает список продуктов от сервера

*События моделей данных*
- `basket:change` - изменение списка товаров в корзине

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:modal` - нажатие на карточку в каталоге
- `basket:open` - нажали на иконку корзины в шапке сайта
- `modal:open` - открыли модальное окно
- `modal:close` - закрыли модальное окно

- `card_full:select` - выбор продукта для добавления в корзину

- `basket__item:remove` - выбор продукта для удаления из корзины

- `basket:confirm` - подтверждение покупки содержимого корзины
- `order:submit` - подтверждение заполнения информации о покупки
- `contacts:submit` - подтверждение заполнения контактов и совершение покупки
- `order-success:done` - завершение процесса покупки и очистка корзины